import * as React from 'react';
import { omit } from '../utils/omit';
/**
 * Given the state and an array of slot names, will break out `slots` and `slotProps`
 * collections.
 *
 * The root is derived from a mix of `components` props and `as` prop.
 *
 * Slots will render as null if they are rendered as primitives with undefined children.
 *
 * The slotProps will always omit the `as` prop within them, and for slots that are string
 * primitives, the props will be filtered according to the slot type by the type system.
 * For example, if the slot is rendered `as: 'a'`, the props will be filtered for acceptable
 * anchor props. Note that this is only enforced at build time by Typescript -- there is no
 * runtime code filtering props in this function.
 *
 * @param state - State including slot definitions
 * @returns An object containing the `slots` map and `slotProps` map.
 */

export function getSlots(state) {
  const slots = {};
  const slotProps = {};
  const slotNames = Object.keys(state.components);

  for (const slotName of slotNames) {
    const [slot, props] = getSlot(state, slotName);
    slots[slotName] = slot;
    slotProps[slotName] = props;
  }

  return {
    slots,
    slotProps: slotProps
  };
}

function getSlot(state, slotName) {
  var _a, _b, _c;

  if (state[slotName] === undefined) {
    return [null, undefined];
  }

  const {
    children,
    as: asProp,
    ...rest
  } = state[slotName];
  const slot = ((_a = state.components) === null || _a === void 0 ? void 0 : _a[slotName]) === undefined || typeof state.components[slotName] === 'string' ? asProp || ((_b = state.components) === null || _b === void 0 ? void 0 : _b[slotName]) || 'div' : state.components[slotName];

  if (typeof children === 'function') {
    const render = children;
    return [React.Fragment, {
      children: render(slot, rest)
    }];
  }

  const shouldOmitAsProp = typeof slot === 'string' && ((_c = state[slotName]) === null || _c === void 0 ? void 0 : _c.as);
  const slotProps = shouldOmitAsProp ? omit(state[slotName], ['as']) : state[slotName];
  return [slot, slotProps];
}
//# sourceMappingURL=getSlots.js.map